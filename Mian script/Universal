local repo = "https://raw.githubusercontent.com/deividcomsono/Obsidian/main/"
local Library = loadstring(game:HttpGet(repo .. "Library.lua"))()
local ThemeManager = loadstring(game:HttpGet(repo .. "addons/ThemeManager.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/wszzx2013/yezx/refs/heads/main/Obsidian%20ui/%E9%85%8D%E7%BD%AE"))()

-- 创建主窗口
local Window = Library:CreateWindow({
    Title = "yezx",
    Footer = "v1.0.0",
    ToggleKeybind = Enum.KeyCode.RightShift,
    Center = true,
    AutoShow = true
})

-- 移动端适配
if Library.IsMobile then
    Window:UpdateConfig({
        MobileButtonsSide = "Left"
    })
end

-- 创建选项卡
local Tabs = {
    infoTab = Window:AddTab("信息", "info"),
    playerTab = Window:AddTab("玩家", "user-round"),
    ["UI Settings"] = Window:AddTab("设置", "settings"),
}

---- 水印设置 ----
Library:SetWatermarkVisibility(true)

local FrameTimer = tick()
local FrameCounter = 0
local FPS = 60

-- 获取北京时间函数
local function GetBeijingTime()
    local localTime = os.date("*t")
    return string.format("%02d:%02d:%02d", 
        localTime.hour, localTime.min, localTime.sec)
end

-- 实时更新水印
local WatermarkConnection = game:GetService('RunService').RenderStepped:Connect(function()
    FrameCounter = FrameCounter + 1
    
    if (tick() - FrameTimer) >= 1 then
        FPS = FrameCounter
        FrameTimer = tick()
        FrameCounter = 0
    end
    
    Library:SetWatermark(('yezx hub | %s fps | %s ms | 本地时间: %s'):format(
        math.floor(FPS),
        math.floor(game:GetService('Stats').Network.ServerStatsItem['Data Ping']:GetValue()),
        GetBeijingTime()
    ))
end)

-- 菜单设置组
local MenuGroup = Tabs["UI Settings"]:AddLeftGroupbox("菜单设置", "wrench")

-- 键位绑定菜单开关
MenuGroup:AddToggle("KeybindMenuOpen", {
    Default = Library.KeybindFrame.Visible,
    Text = "显示键位菜单",
    Callback = function(value)
        Library.KeybindFrame.Visible = value
    end,
})

-- 自定义光标
MenuGroup:AddToggle("ShowCustomCursor", {
    Text = "自定义光标",
    Default = true,
    Callback = function(Value)
        Library.ShowCustomCursor = Value
    end,
})

-- 通知位置
MenuGroup:AddDropdown("NotificationSide", {
    Values = { "左侧", "右侧" },
    Default = "右侧",
    Text = "通知位置",
    Callback = function(Value)
        Library:SetNotifySide(Value == "左侧" and "Left" or "Right")
    end,
})

-- DPI缩放
MenuGroup:AddDropdown("DPIDropdown", {
    Values = { "50%", "75%", "100%", "125%", "150%", "175%", "200%" },
    Default = "100%",
    Text = "界面缩放",
    Callback = function(Value)
        Value = Value:gsub("%%", "")
        local DPI = tonumber(Value) / 100
        Library:SetDPIScale(DPI)
    end,
})

MenuGroup:AddDivider()

-- 菜单键位设置 - 先创建键位选择器
local menuKeybind = MenuGroup:AddLabel("菜单键位")
    :AddKeyPicker("MenuKeybind", { 
        Default = "RightShift", 
        NoUI = true, 
        Text = "菜单键位" 
    })

-- 卸载按钮
MenuGroup:AddButton("卸载脚本", function()
    Library:Unload()
    if WatermarkConnection then
        WatermarkConnection:Disconnect()
    end
end)

-- 设置菜单键位 - 使用正确的引用
Library.ToggleKeybind = menuKeybind

-- 主题管理器设置
ThemeManager:SetLibrary(Library)
ThemeManager:SetFolder("yezxHub")

-- 配置管理器设置
SaveManager:SetLibrary(Library)
SaveManager:SetIgnoreIndexes({ "MenuKeybind" })
SaveManager:SetFolder("yezxHub/specific-game")
SaveManager:SetSubFolder("specific-place")

-- 应用主题和配置
ThemeManager:ApplyToTab(Tabs["UI Settings"])
SaveManager:BuildConfigSection(Tabs["UI Settings"])
SaveManager:LoadAutoloadConfig()

-- 在这里添加您的功能代码
-- 例如：信息选项卡内容
local InfoGroup = Tabs.infoTab:AddLeftGroupbox("信息")
InfoGroup:AddLabel("yezx Hub v1.0.0")
InfoGroup:AddLabel("作者: Tu")
InfoGroup:AddLabel("感谢使用！")

-- 玩家选项卡内容
local PlayerGroup = Tabs.playerTab:AddLeftGroupbox("玩家设置")
PlayerGroup:AddSlider("WalkSpeed", {
    Text = "移动速度",
    Default = 16,
    Min = 16,
    Max = 100,
    Rounding = 0,
    Callback = function(Value)
        if game.Players.LocalPlayer.Character then
            game.Players.LocalPlayer.Character.Humanoid.WalkSpeed = Value
        end
    end
})

PlayerGroup:AddSlider("JumpPower", {
    Text = "跳跃高度",
    Default = 50,
    Min = 50,
    Max = 200,
    Rounding = 0,
    Callback = function(Value)
        if game.Players.LocalPlayer.Character then
            game.Players.LocalPlayer.Character.Humanoid.JumpPower = Value
        end
    end
})

-- 显示加载完成通知
Library:Notify({
    Title = "yezx Hub",
    Description = "脚本加载完成！",
    Time = 3
})
